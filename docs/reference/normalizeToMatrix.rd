<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Normalize Associations between Genomic Signals and Target Regions into a Matrix — normalizeToMatrix • EnrichedHeatmap</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Normalize Associations between Genomic Signals and Target Regions into a Matrix — normalizeToMatrix"><meta property="og:description" content="Normalize Associations between Genomic Signals and Target Regions into a Matrix"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EnrichedHeatmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.33.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Vignettes</li>
    <li>
      <a href="../articles/EnrichedHeatmap_intro.html">Make Enriched Heatmaps</a>
    </li>
    <li>
      <a href="../articles/visualize_categorical_signals.html">Visualize Categorical Signals</a>
    </li>
    <li>
      <a href="../articles/row_ordering.html">Compare row ordering methods</a>
    </li>
    <li>
      <a href="../articles/roadmap.html">Visualize Comprehensive Associations in Roadmap dataset</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">More applications</li>
  </ul></li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/jokergoo/EnrichedHeatmap/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Normalize Associations between Genomic Signals and Target Regions into a Matrix</h1>
    
    <div class="hidden name"><code>normalizeToMatrix.rd</code></div>
    </div>

    <div class="ref-description">
    <p>Normalize Associations between Genomic Signals and Target Regions into a Matrix</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">normalizeToMatrix</span><span class="op">(</span><span class="va">signal</span>, <span class="va">target</span>, extend <span class="op">=</span> <span class="fl">5000</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">extend</span><span class="op">)</span><span class="op">/</span><span class="fl">100</span>,</span>
<span>    value_column <span class="op">=</span> <span class="cn">NULL</span>, mapping_column <span class="op">=</span> <span class="cn">NULL</span>, background <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">smooth</span>, <span class="cn">NA</span>, <span class="fl">0</span><span class="op">)</span>, </span>
<span>    empty_value <span class="op">=</span> <span class="cn">NULL</span>, mean_mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"absolute"</span>, <span class="st">"weighted"</span>, <span class="st">"w0"</span>, <span class="st">"coverage"</span><span class="op">)</span>, </span>
<span>    include_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="fu">width</span><span class="op">(</span><span class="va">target</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>    target_ratio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">width</span><span class="op">(</span><span class="va">target</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">extend</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">width</span><span class="op">(</span><span class="va">target</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu">width</span><span class="op">(</span><span class="va">target</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, smooth <span class="op">=</span> <span class="cn">FALSE</span>, smooth_fun <span class="op">=</span> <span class="va">default_smooth_fun</span>,</span>
<span>    keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, limit <span class="op">=</span> <span class="cn">NULL</span>, trim <span class="op">=</span> <span class="cn">NULL</span>, flip_upstream <span class="op">=</span> <span class="cn">FALSE</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>signal</dt>
<dd><p>A <code><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges-class</a></code> object.</p></dd>

  <dt>target</dt>
<dd><p>A <code><a href="https://rdrr.io/pkg/GenomicRanges/man/GRanges-class.html" class="external-link">GRanges-class</a></code> object.</p></dd>

  <dt>extend</dt>
<dd><p>Extended base pairs to the upstream and/or downstream of <code>target</code>. It can be a vector of length one or two. Length one means same extension to the upstream and downstream.</p></dd>

  <dt>w</dt>
<dd><p>Window size for splitting upstream and downstream, measured in base pairs</p></dd>

  <dt>value_column</dt>
<dd><p>Column index in <code>signal</code> that is mapped to colors. If it is not set, it assumes values for all signal regions are 1.</p></dd>

  <dt>mapping_column</dt>
<dd><p>Mapping column to restrict overlapping between <code>signal</code> and <code>target</code>. By default it tries to look for all regions in <code>signal</code> that overlap with every target.</p></dd>

  <dt>background</dt>
<dd><p>Values for windows that don't overlap with <code>signal</code>.</p></dd>

  <dt>empty_value</dt>
<dd><p>Deprecated, please use <code>background</code> instead.</p></dd>

  <dt>mean_mode</dt>
<dd><p>When a window is not perfectly overlapped to <code>signal</code>, how to summarize  values to the window. See 'Details' section for a detailed explanation.</p></dd>

  <dt>include_target</dt>
<dd><p>Whether include <code>target</code> in the heatmap? If the width of all regions in <code>target</code> is 1, <code>include_target</code> is enforced to <code>FALSE</code>.</p></dd>

  <dt>target_ratio</dt>
<dd><p>The ratio of <code>target</code> columns in the normalized matrix. If the value is 1, <code>extend</code> will be reset to 0.</p></dd>

  <dt>k</dt>
<dd><p>Number of windows only when <code>target_ratio = 1</code> or <code>extend == 0</code>, otherwise ignored.</p></dd>

  <dt>smooth</dt>
<dd><p>Whether apply smoothing on rows in the matrix?</p></dd>

  <dt>smooth_fun</dt>
<dd><p>The smoothing function that is applied to each row in the matrix. This self-defined function accepts a numeric vector (may contain <code>NA</code> values) and returns a vector with same length. If the smoothing is failed, the function should call <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></code> to throw errors so that <code>normalizeToMatrix</code> can catch how many rows are failed in smoothing.  See the default <code><a href="default_smooth_fun.html">default_smooth_fun</a></code> for example.</p></dd>

  <dt>keep</dt>
<dd><p>Percentiles in the normalized matrix to keep. The value is a vector of two percent values. Values less than the first percentile is replaces with the first pencentile and values larger than the second percentile is replaced with the second percentile.</p></dd>

  <dt>limit</dt>
<dd><p>Similar as <code>keep</code>, but it provides boundary for absolute values. The value should be a vector of length two.</p></dd>

  <dt>trim</dt>
<dd><p>Deprecated, please use <code>keep</code> instead.</p></dd>

  <dt>flip_upstream</dt>
<dd><p>Sometimes whether the signals are on the upstream or the downstream of the targets are not important and users only want to show the relative distance to targets. If the value is set to <code>TRUE</code>, the upstream part in the normalized matrix is flipped and added to the downstream part The flipping is only allowed when the targets are single-point targets or the targets are excluded in the normalized matrix (by setting <code>include_target = FALSE</code>). If the extension for the upstream and downstream is not equal, the smaller extension is used for the final matrix.</p></dd>

  <dt>verbose</dt>
<dd><p>Whether to print help messages.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>In order to visualize associations between <code>signal</code> and <code>target</code>, the data is transformed into a matrix
and visualized as a heatmap by <code><a href="EnrichedHeatmap.html">EnrichedHeatmap</a></code> afterwards.</p>
<p>Upstream and downstream also with the target body are splitted into a list of small windows and overlap
to <code>signal</code>. Since regions in <code>signal</code> and small windows do not always 100 percent overlap, there are four different averaging modes:</p>
<p>Following illustrates different settings for <code>mean_mode</code> (note there is one signal region overlapping with other signals):</p>
<p></p><div class="sourceCode"><pre><code>
      40      50     20     values in signal regions
    ++++++   +++    +++++   signal regions
           30               values in signal region
         ++++++             signal region
      =================     a window (17bp), there are 4bp not overlapping to any signal regions.
        4  6  3      3      overlap

    absolute: (40 + 30 + 50 + 20)/4
    weighted: (40*4 + 30*6 + 50*3 + 20*3)/(4 + 6 + 3 + 3)
    w0:       (40*4 + 30*6 + 50*3 + 20*3)/(4 + 6 + 3 + 3 + 4)
    coverage: (40*4 + 30*6 + 50*3 + 20*3)/17  </code></pre></div>

    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>A matrix with following additional attributes:</p>


<dl><dt><code>upstream_index</code></dt>
<dd><p>column index corresponding to upstream of <code>target</code></p></dd>

  <dt><code>target_index</code></dt>
<dd><p>column index corresponding to <code>target</code></p></dd>

  <dt><code>downstream_index</code></dt>
<dd><p>column index corresponding to downstream of <code>target</code></p></dd>

  <dt><code>extend</code></dt>
<dd><p>extension on upstream and downstream</p></dd>

  <dt><code>smooth</code></dt>
<dd><p>whether smoothing was applied on the matrix</p></dd>

  <dt><code>failed_rows</code></dt>
<dd><p>index of rows which are failed after smoothing</p></dd>


</dl><p>The matrix is wrapped into a simple <code>normalizeToMatrix</code> class.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Zuguang Gu &lt;z.gu@dkfz.de&gt;</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">signal</span> <span class="op">=</span> <span class="fu">GRanges</span><span class="op">(</span>seqnames <span class="op">=</span> <span class="st">"chr1"</span>, </span></span>
<span class="r-in"><span>    ranges <span class="op">=</span> <span class="fu">IRanges</span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">11</span>, <span class="fl">14</span>, <span class="fl">17</span>, <span class="fl">21</span>, <span class="fl">24</span>, <span class="fl">27</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">8</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">22</span>, <span class="fl">25</span>, <span class="fl">28</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target</span> <span class="op">=</span> <span class="fu">GRanges</span><span class="op">(</span>seqnames <span class="op">=</span> <span class="st">"chr1"</span>, ranges <span class="op">=</span> <span class="fu">IRanges</span><span class="op">(</span>start <span class="op">=</span> <span class="fl">10</span>, end <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">normalizeToMatrix</span><span class="op">(</span><span class="va">signal</span>, <span class="va">target</span>, extend <span class="op">=</span> <span class="fl">10</span>, w <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Normalize signal to target:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Upstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Downstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Include target regions (6 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 target region</span>
<span class="r-in"><span><span class="fu">normalizeToMatrix</span><span class="op">(</span><span class="va">signal</span>, <span class="va">target</span>, extend <span class="op">=</span> <span class="fl">10</span>, w <span class="op">=</span> <span class="fl">2</span>, include_target <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Normalize signal to target:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Upstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Downstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Include target regions (6 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 target region</span>
<span class="r-in"><span><span class="fu">normalizeToMatrix</span><span class="op">(</span><span class="va">signal</span>, <span class="va">target</span>, extend <span class="op">=</span> <span class="fl">10</span>, w <span class="op">=</span> <span class="fl">2</span>, value_column <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Normalize signal to target:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Upstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Downstream 10 bp (5 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Include target regions (6 windows)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1 target region</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  <style>nav[data-toggle='toc'] .nav .nav {display: block;}</style></body></html>

